<!-- START FORMULAR FAST ANY MOVES -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDex0iuSIdBsP21VWQJxws0dlpUj9heWac&libraries=places"></script>

<div id="quoteFormContainer">
    <!-- Logo -->
    <div style="text-align:center;margin-bottom:20px;">
        <img src="logo.png" alt="FAST ANY MOVES LTD" style="max-width:200px;">
    </div>

    <h2>Instant Moving Quote</h2>
    <p>Help us serve you better</p>

    <form id="quoteForm">
        <!-- Client info -->
        <input type="text" id="name" placeholder="Name *" required>
        <input type="tel" id="phone" placeholder="Phone *" required>
        <input type="email" id="email" placeholder="Email *" required>
        <input type="datetime-local" id="moveDate" required>

        <label>Do you need help with loading and unloading? *</label>
        <select id="service" required>
            <option value="45">No help required + Medium Van</option>
            <option value="40">1 Man + Medium Van</option>
            <option value="70">2 Men + Medium Van</option>
            <option value="100">3 Men + Medium Van</option>
        </select>

        <!-- Collection -->
        <h3>Collection Address *</h3>
        <input type="text" id="collectionPostcode" placeholder="Postcode *" required>
        <select id="collectionSelect" required></select>
        <label>Collection Stairs</label>
        <select id="stairsCollection">
            <option value="0">Ground floor / Lift</option>
            <option value="1">1 Flight</option>
            <option value="2">2 Flights</option>
            <option value="3">3 Flights</option>
            <option value="4">4 Flights</option>
        </select>

        <!-- Via -->
        <h3>Via Address (Optional)</h3>
        <input type="text" id="viaPostcode" placeholder="Postcode">
        <select id="viaSelect"></select>
        <label>Via Stairs</label>
        <select id="stairsVia">
            <option value="0">Ground floor / Lift</option>
            <option value="1">1 Flight</option>
            <option value="2">2 Flights</option>
            <option value="3">3 Flights</option>
            <option value="4">4 Flights</option>
        </select>

        <!-- Delivery -->
        <h3>Delivery Address *</h3>
        <input type="text" id="deliveryPostcode" placeholder="Postcode *" required>
        <select id="deliverySelect" required></select>
        <label>Delivery Stairs</label>
        <select id="stairsDelivery">
            <option value="0">Ground floor / Lift</option>
            <option value="1">1 Flight</option>
            <option value="2">2 Flights</option>
            <option value="3">3 Flights</option>
            <option value="4">4 Flights</option>
        </select>

        <textarea id="additional" placeholder="Additional Information"></textarea>
        <button type="submit">Get My Instant Quote</button>
    </form>

    <div id="result"></div>
</div>

<script>
emailjs.init("GR5ehmpI9S5BvHCGb"); // NU schimba asta

document.getElementById("moveDate").min = new Date().toISOString().slice(0,16);

function setupAutocomplete(postcodeInput, selectElement) {
    postcodeInput.addEventListener("blur", function(){
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({address: postcodeInput.value}, function(results, status){
            if(status === "OK"){
                selectElement.innerHTML = "";
                results.forEach(r=>{
                    const opt = document.createElement("option");
                    opt.value = r.formatted_address;
                    opt.textContent = r.formatted_address;
                    selectElement.appendChild(opt);
                });
            }
        });
    });
}

// Setup all autocomplete selects
setupAutocomplete(document.getElementById("collectionPostcode"), document.getElementById("collectionSelect"));
setupAutocomplete(document.getElementById("viaPostcode"), document.getElementById("viaSelect"));
setupAutocomplete(document.getElementById("deliveryPostcode"), document.getElementById("deliverySelect"));

// Quote calculation & WhatsApp
document.getElementById("quoteForm").addEventListener("submit", function(e){
    e.preventDefault();

    const rate = parseFloat(document.getElementById("service").value);
    const stairsTotal = parseInt(document.getElementById("stairsCollection").value) +
                        parseInt(document.getElementById("stairsVia").value) +
                        parseInt(document.getElementById("stairsDelivery").value);

    const collection = document.getElementById("collectionSelect").value;
    const via = document.getElementById("viaSelect").value;
    const delivery = document.getElementById("deliverySelect").value;

    const service = new google.maps.DistanceMatrixService();
    let destinations = via ? [via, delivery] : [delivery];

    service.getDistanceMatrix({
        origins:[collection],
        destinations:destinations,
        travelMode: google.maps.TravelMode.DRIVING
    }, function(response,status){
        if(status!=="OK"){ alert("Distance calculation error"); return; }

        let totalMeters=0;
        let totalSeconds=0;
        response.rows[0].elements.forEach(el=>{
            totalMeters+=el.distance.value;
            totalSeconds+=el.duration.value;
        });

        let miles = totalMeters/1609.34;
        let costMiles = miles*1.5;
        let loadingTime = 45*60;
        let stairsTime = stairsTotal*10*60;
        let estimatedSeconds = totalSeconds+loadingTime+stairsTime;
        let estimatedHours = estimatedSeconds/3600;
        let roundedHours = Math.ceil(estimatedHours);
        if(roundedHours < 2) roundedHours = 2;
        let costHours = roundedHours*rate;
        let costStairs = (rate!==45)?stairsTotal*10:0;
        let total = costHours+costMiles+costStairs;

        let finalHours = Math.floor(estimatedSeconds/3600);
        let finalMinutes = Math.round((estimatedSeconds%3600)/60);

        let breakdown =
            "Estimated working time: "+finalHours+"h "+finalMinutes+"m\n"+
            "Hours charged (rounded): "+roundedHours+"\n\n"+
            "Cost hours: Â£"+costHours.toFixed(2)+"\n"+
            "Miles: "+miles.toFixed(2)+"\n"+
            "Cost miles: Â£"+costMiles.toFixed(2)+"\n\n"+
            "Total flights: "+stairsTotal+"\n"+
            "Cost stairs: Â£"+costStairs.toFixed(2)+"\n\n"+
            "TOTAL: Â£"+total.toFixed(2);

        // Send WhatsApp
        const phone = encodeURIComponent("07846769519"); // your number
        const message = encodeURIComponent(
            "ðŸšš Instant Moving Quote\n"+
            "Name: "+document.getElementById("name").value+"\n"+
            "Phone: "+document.getElementById("phone").value+"\n"+
            "Email: "+document.getElementById("email").value+"\n"+
            "Move Date: "+document.getElementById("moveDate").value+"\n"+
            "Collection: "+collection+"\n"+
            (via ? "Via: "+via+"\n":"")+
            "Delivery: "+delivery+"\n\n"+
            breakdown
        );
        window.open("https://wa.me/"+phone+"?text="+message,"_blank");

        document.getElementById("result").innerHTML = "<span style='color:green;font-weight:bold'>Quote prepared! Click WhatsApp to send.</span>";
    });
});
</script>
<!-- END FORMULAR FAST ANY MOVES -->
