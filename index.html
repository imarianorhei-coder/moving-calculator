<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instant Moving Quote</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px;}
.container { max-width:800px; margin:auto; background:#fff; padding:25px; border-radius:8px;}
h2 { text-align:center; margin-bottom:20px;}
input, select, textarea, button {
width:100%; padding:10px; margin:8px 0; border-radius:5px; border:1px solid #ccc;
font-size:14px;
}
button { background:#000; color:#fff; font-size:16px; cursor:pointer;}
button:hover { background:#333;}
.result { background:#f9f9f9; padding:15px; margin-top:15px; border-radius:6px; white-space:pre-line;}
.warning { color:#c00000; font-weight:bold; margin-top:10px;}
</style>

<script src="https://maps.googleapis.com/maps/api/js?key= AIzaSyA-P2kaqlMH-EOFjVIHbZ4S0Ki8DN2WVFE&libraries=places"></script>

</head>
<body>

<div class="container">
<h2>Instant Moving Quote</h2>

<form id="quoteForm" action="https://formsubmit.co/imarianorhei@gmail.com" method="POST">
<input type="hidden" name="_captcha" value="false">
<input type="hidden" name="Quote_Breakdown" id="breakdown">

<label>Name *</label>
<input type="text" name="Name" required>

<label>Phone *</label>
<input type="text" name="Phone" required>

<label>Email *</label>
<input type="email" name="Email" required>

<label>Move Date *</label>
<input type="datetime-local" id="moveDate" name="Move_Date" required>

<label>Hours (Minimum 2) *</label>
<input type="number" id="hours" name="Hours" min="2" required>

<label>Help Required *</label>
<select id="service" name="Service" required>
<option value="">Select</option>
<option value="45">No help required</option>
<option value="55">1 Man</option>
<option value="70">2 Men</option>
<option value="90">3 Men</option>
</select>

<label>Collection Address *</label>
<input type="text" id="collection" name="Collection_Address" required>

<label>Collection Stairs *</label>
<select id="collectionStairs" name="Collection_Stairs" required>
<option value="0">No stairs</option>
<option value="1">1 Flight</option>
<option value="2">2 Flights</option>
<option value="3">3 Flights</option>
<option value="4">4 Flights</option>
</select>

<label>Via Address (optional)</label>
<input type="text" id="via" name="Via_Address">

<label>Via Stairs</label>
<select id="viaStairs" name="Via_Stairs">
<option value="0">No stairs</option>
<option value="1">1 Flight</option>
<option value="2">2 Flights</option>
<option value="3">3 Flights</option>
<option value="4">4 Flights</option>
</select>

<label>Delivery Address *</label>
<input type="text" id="delivery" name="Delivery_Address" required>

<label>Delivery Stairs *</label>
<select id="deliveryStairs" name="Delivery_Stairs" required>
<option value="0">No stairs</option>
<option value="1">1 Flight</option>
<option value="2">2 Flights</option>
<option value="3">3 Flights</option>
<option value="4">4 Flights</option>
</select>

<label>Additional Info</label>
<textarea name="Additional_Info"></textarea>

<button type="submit">Get My Instant Quote</button>
</form>

<div id="result" class="result" style="display:none;"></div>
</div>

<script>

// Restrict date to future
const dateInput = document.getElementById("moveDate");
const now = new Date();
now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
dateInput.min = now.toISOString().slice(0,16);

// Autocomplete UK
function initAutocomplete() {
const options = {
componentRestrictions: { country: "uk" },
types: ["address"]
};
new google.maps.places.Autocomplete(document.getElementById("collection"), options);
new google.maps.places.Autocomplete(document.getElementById("delivery"), options);
new google.maps.places.Autocomplete(document.getElementById("via"), options);
}
google.maps.event.addDomListener(window, 'load', initAutocomplete);

// Calculator
document.getElementById("quoteForm").addEventListener("submit", function(e) {
e.preventDefault();

let hours = Math.max(2, parseInt(document.getElementById("hours").value));
let rate = parseInt(document.getElementById("service").value);

let collection = document.getElementById("collection").value;
let delivery = document.getElementById("delivery").value;
let via = document.getElementById("via").value;

let totalFlights =
parseInt(document.getElementById("collectionStairs").value) +
parseInt(document.getElementById("deliveryStairs").value) +
parseInt(document.getElementById("viaStairs").value);

let directionsService = new google.maps.DirectionsService();
let waypoints = [];

if (via !== "") {
waypoints.push({ location: via, stopover: true });
}

directionsService.route({
origin: collection,
destination: delivery,
waypoints: waypoints,
travelMode: 'DRIVING'
}, function(response, status) {

if (status === 'OK') {

let distance = 0;
let duration = 0;

response.routes[0].legs.forEach(leg => {
distance += leg.distance.value;
duration += leg.duration.value;
});

let miles = distance / 1609.34;
let costMiles = miles * 1.5;
let costHours = hours * rate;

let men = 0;
if (rate === 55) men = 1;
if (rate === 70) men = 2;
if (rate === 90) men = 3;

let stairCost = 0;
if (rate !== 45) {
stairCost = totalFlights * 10 * men;
}

let total = costHours + costMiles + stairCost;

// ===== PROFESSIONAL TIME CALCULATION =====

let driveMinutes = duration / 60;

let loadingMinutes = 0;
let stairsMinutes = 0;

if (rate !== 45) {

if (men === 1) loadingMinutes = 90;
if (men === 2) loadingMinutes = 60;
if (men === 3) loadingMinutes = 45;

let minutesPerFlight = 10;
if (men === 2) minutesPerFlight = 8;
if (men === 3) minutesPerFlight = 6;

stairsMinutes = totalFlights * minutesPerFlight;
}

let totalMinutes = driveMinutes + loadingMinutes + stairsMinutes;

// Auto adjust booked hours if insufficient
let requiredHours = Math.ceil(totalMinutes / 60);

let warningMessage = "";
if (requiredHours > hours) {
warningMessage = `
⚠️ Estimated job duration exceeds booked hours.
Recommended minimum booking: ${requiredHours} hours.
`;
}

// Format time
let totalHoursFormatted = Math.floor(totalMinutes / 60);
let remainingMinutes = Math.ceil(totalMinutes % 60);
let formattedTime = `${totalHoursFormatted}h ${remainingMinutes}m`;

let breakdown = `
Hours charged: ${hours}
Cost hours: £${costHours.toFixed(2)}
Miles: ${miles.toFixed(2)}
Cost miles: £${costMiles.toFixed(2)}
Total flights: ${totalFlights}
Cost stairs: £${stairCost.toFixed(2)}
Total final: £${total.toFixed(2)}
Estimated total time: ${formattedTime}
${warningMessage}
`;

document.getElementById("result").style.display = "block";
document.getElementById("result").innerText = breakdown;
document.getElementById("breakdown").value = breakdown;

setTimeout(function(){
e.target.submit();
},1500);

} else {
alert("Could not calculate route. Please check addresses.");
}

});

});

</script>

</body>
</html>
